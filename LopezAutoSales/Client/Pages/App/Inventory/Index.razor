@page "/app/inventory"
@attribute [Authorize(Roles = "Admin")]
@inject AuthHttp http

<h1 class="text-center">Inventory</h1>
<div class="text-right my-2">
    <a href="/app/inventory/add" class="btn btn-secondary"><i class="mdi mdi-plus"></i> Add Vehicle</a>
</div>
@if (Inventory == null || Inventory.Cars.Count() == 0)
{
    <p class="lead">There's currently no active vehicles in inventory.</p>
}
else
{
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th class="pointer" scope="col" @onclick="() => Inventory.Sort(Inventory.SortMethod.Year)">
                        Year
                    </th>
                    <th class="pointer" scope="col" @onclick="() => Inventory.Sort(Inventory.SortMethod.Make)">
                        Make
                    </th>
                    <th class="pointer" scope="col" @onclick="() => Inventory.Sort(Inventory.SortMethod.Model)">
                        Model
                    </th>
                    <th class="pointer" scope="col" @onclick="() => Inventory.Sort(Inventory.SortMethod.Mileage)">
                        Mileage
                    </th>
                    <th class="pointer" scope="col" @onclick="() => Inventory.Sort(Inventory.SortMethod.BoughtPrice)">
                        Bought Price
                    </th>
                    <th class="pointer" scope="col" @onclick="() => Inventory.Sort(Inventory.SortMethod.ListPrice)">
                        List Price
                    </th>
                    <th class="pointer" scope="col" @onclick="() => Inventory.Sort(Inventory.SortMethod.Salvage)">
                        Salvage
                    </th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (Car car in Inventory.Cars)
                {
                    <tr>
                        <td>
                            @car.Year
                        </td>
                        <td>@car.Make</td>
                        <td>@car.Model</td>
                        <td>@car.MileageString</td>
                        <td class=@(car.BoughtPrice.HasValue ? string.Empty : "table-danger")>
                            @car.BoughtPrice?.ToString("C")
                        </td>
                        <td>@car.ListPrice.ToString("C")</td>
                        <td class="text-center">
                            <input class="form-check-input position-static" disabled type="checkbox" @bind="car.IsSalvage" />
                        </td>
                        <td>
                            <a href="/app/inventory/edit/@car.Id" class="btn btn-sm btn-secondary">View</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

@code {
    public Inventory Inventory { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Inventory = new Inventory(await http.Client.GetFromJsonAsync<IEnumerable<Car>>("/api/inventory"));
        await base.OnInitializedAsync();
    }
}
